<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listado de Avisos de Adopción</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

    <header>
        <h1>Listado de Avisos de Adopción</h1>
        <nav>
            <ul>
                <li><a href="{{ url_for('index') }}">Volver a la Portada</a></li>
                <li><a href="{{ url_for('agregar_aviso') }}">Agregar aviso de adopción</a></li>
                <li><a href="{{ url_for('estadisticas') }}">Estadísticas</a></li>
            </ul>
        </nav>
    </header>

    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="messages">
                    {% for category, message in messages %}
                        <div class="message {{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <h2>Mascotas Buscando un Hogar</h2>
        <p>Haz clic en cualquier fila para ver más detalles sobre la mascota.</p>

        <table id="tabla-avisos">
            <thead>
                <tr>
                    <th>Fecha Publicación</th>
                    <th>Fecha Entrega</th>
                    <th>Comuna</th>
                    <th>Sector</th>
                    <th>Cantidad, Tipo y Edad</th>
                    <th>Nombre Contacto</th>
                    <th>Total Fotos</th>
                </tr>
            </thead>
            <tbody>
                {% if avisos.items %}
                    {% for aviso in avisos.items %}
                    <tr data-id="{{ aviso.id }}">
                        <td>{{ aviso.fecha_ingreso.strftime('%Y-%m-%d') }}</td>
                        <td>{{ aviso.fecha_entrega.strftime('%Y-%m-%d') }}</td>
                        <td>{{ aviso.comuna.nombre }}</td>
                        <td>{{ aviso.sector or '' }}</td>
                        <td>
                            {{ aviso.cantidad }} {{ aviso.tipo }}{% if aviso.cantidad > 1 %}s{% endif %} 
                            de {{ aviso.edad }} {% if aviso.unidad_medida == 'a' %}año{% else %}mes{% endif %}{% if aviso.edad > 1 %}{% if aviso.unidad_medida == 'a' %}s{% else %}es{% endif %}{% endif %}
                        </td>
                        <td>{{ aviso.nombre }}</td>
                        <td>{{ aviso.fotos|length or 0 }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr data-id="1">
                        <td>2025-09-04</td>
                        <td>2025-09-08</td>
                        <td>Providencia</td>
                        <td>Metro Los Leones</td>
                        <td>2 gatos de 3 meses</td>
                        <td>Ana González</td>
                        <td>2</td>
                    </tr>
                    <tr data-id="2">
                        <td>2025-09-04</td>
                        <td>2025-09-07</td>
                        <td>Las Condes</td>
                        <td>Parque Araucano</td>
                        <td>1 perro de 1 año</td>
                        <td>Carlos Pérez</td>
                        <td>3</td>
                    </tr>
                    <tr data-id="3">
                        <td>2025-09-03</td>
                        <td>2025-09-05</td>
                        <td>Santiago</td>
                        <td>Parque O'Higgins</td>
                        <td>4 gatos de 2 meses</td>
                        <td>María López</td>
                        <td>1</td>
                    </tr>
                    <tr data-id="4">
                        <td>2025-09-02</td>
                        <td>2025-09-06</td>
                        <td>Ñuñoa</td>
                        <td>Plaza Ñuñoa</td>
                        <td>1 perro de 5 meses</td>
                        <td>Javier Soto</td>
                        <td>2</td>
                    </tr>
                    <tr data-id="5">
                        <td>2025-09-01</td>
                        <td>2025-09-04</td>
                        <td>La Florida</td>
                        <td>Walker Martínez</td>
                        <td>3 perros de 4 meses</td>
                        <td>Lucía Fernández</td>
                        <td>1</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>

        <!-- Paginación -->
        {% if avisos.pages > 1 %}
        <div class="pagination">
            {% if avisos.has_prev %}
                <a href="{{ url_for('listado_avisos', page=avisos.prev_num, tipo=tipo_filtro, region=region_filtro) }}">&laquo; Anterior</a>
            {% endif %}
            
            {% for page_num in avisos.iter_pages() %}
                {% if page_num %}
                    {% if page_num != avisos.page %}
                        <a href="{{ url_for('listado_avisos', page=page_num, tipo=tipo_filtro, region=region_filtro) }}">{{ page_num }}</a>
                    {% else %}
                        <span class="current">{{ page_num }}</span>
                    {% endif %}
                {% else %}
                    <span>...</span>
                {% endif %}
            {% endfor %}
            
            {% if avisos.has_next %}
                <a href="{{ url_for('listado_avisos', page=avisos.next_num, tipo=tipo_filtro, region=region_filtro) }}">Siguiente &raquo;</a>
            {% endif %}
        </div>
        {% endif %}
    </main>

    <div id="modal-detalle" class="modal">
        <div class="modal-contenido">
            <span class="cerrar-modal" id="cerrar-detalle">&times;</span>
            <h2>Detalles del Aviso de Adopción</h2>
            <p><strong>Nombre Contacto:</strong> <span id="detalle-nombre"></span></p>
            <p><strong>Email:</strong> <span id="detalle-email"></span></p>
            <p><strong>Celular:</strong> <span id="detalle-celular"></span></p>
            <p><strong>Comuna:</strong> <span id="detalle-comuna"></span></p>
            <p><strong>Descripción:</strong></p>
            <p id="detalle-descripcion"></p>
            <h3>Fotos</h3>
            <div id="detalle-fotos" class="galeria-fotos">
            </div>
            <a href="{{ url_for('index') }}" class="boton-modal">Volver a la Portada</a>
        </div>
    </div>

    <div id="modal-foto" class="modal">
        <span class="cerrar-modal" id="cerrar-foto">&times;</span>
        <img class="modal-foto-grande" id="foto-grande" src="none" alt="Foto de mascota en grande">
    </div>

    <footer>
        <p>Desarrollo de Aplicaciones Web - Tarea 1</p>
        <p>Gabriel Gallardo R.</p>
    </footer>

    <script src="{{ url_for('static', filename='js/listado.js') }}"></script>

</body>
</html>
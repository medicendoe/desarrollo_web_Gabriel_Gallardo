<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adopción de Mascotas - Portada</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

    <header>
        <h1>Portal de Adopción de Mascotas 🐾</h1>
        <p>¡Encuentra a tu compañero ideal!</p>
        <nav>
            <ul>
                <li><a href="{{ url_for('main.agregar_aviso') }}">Agregar aviso de adopción</a></li>
                <li><a href="{{ url_for('main.listado_avisos') }}">Ver listado de adopciones</a></li>
                <li><a href="{{ url_for('main.estadisticas') }}">Estadísticas</a></li>
            </ul>
        </nav>
    </header>

    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="messages">
                    {% for category, message in messages %}
                        <div class="message {{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <h2>Últimos 5 Avisos Agregados</h2>
        <p>Estos son los últimos animalitos que esperan por un hogar. ¡Anímate a conocerlos!</p>

        <table>
            <thead>
                <tr>
                    <th>Fecha publicación</th>
                    <th>Comuna</th>
                    <th>Sector</th>
                    <th>Cantidad, Tipo y Edad</th>
                    <th>Foto</th>
                </tr>
            </thead>
            <tbody>
                                <tbody>
                {% if avisos %}
                    {% for aviso in avisos %}
                    <tr>
                        <td>{{ aviso.fecha_ingreso.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>{{ aviso.comuna.nombre if aviso.comuna else 'Sin especificar' }}</td>
                        <td>{{ aviso.sector or 'Sin especificar' }}</td>
                        <td>
                            {{ aviso.cantidad }} {{ aviso.tipo }}{% if aviso.cantidad > 1 %}s{% endif %}
                            {% if aviso.edad %}
                                de {{ aviso.edad }} {% if aviso.unidad_medida == 'a' %}año{% else %}mes{% endif %}{% if aviso.edad > 1 %}{% if aviso.unidad_medida == 'a' %}s{% else %}es{% endif %}{% endif %}
                            {% endif %}
                        </td>
                        <td>
                            {% if aviso.fotos %}
                                <img src="{{ url_for('static', filename=aviso.fotos[0].ruta_archivo) }}" 
                                     alt="Foto de {{ aviso.tipo }}" width="100" height="75">
                            {% else %}
                                {% if aviso.tipo == 'gato' %}
                                    <img src="https://cataas.com/cat?width=100&height=75" alt="Foto de gatitos">
                                {% else %}
                                    <img src="https://placedog.net/100/75" alt="Foto de perrito">
                                {% endif %}
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td>2025-09-04 15:30</td>
                        <td>Providencia</td>
                        <td>Metro Los Leones</td>
                        <td>2 gatos de 3 meses</td>
                        <td><img src="https://cataas.com/cat?width=100&height=75" alt="Foto de gatitos"></td>
                    </tr>
                    <tr>
                        <td>2025-09-04 11:00</td>
                        <td>Las Condes</td>
                        <td>Parque Araucano</td>
                        <td>1 perro de 1 año</td>
                        <td><img src="https://placedog.net/100/75" alt="Foto de perrito"></td>
                    </tr>
                    <tr>
                        <td>2025-09-03 19:45</td>
                        <td>Santiago</td>
                        <td>Parque O'Higgins</td>
                        <td>4 gatos de 2 meses</td>
                        <td><img src="https://cataas.com/cat?width=100&height=76" alt="Foto de varios gatitos"></td>
                    </tr>
                    <tr>
                        <td>2025-09-02 21:00</td>
                        <td>Ñuñoa</td>
                        <td>Plaza Ñuñoa</td>
                        <td>1 perro de 5 meses</td>
                        <td><img src="https://placedog.net/100/76" alt="Foto de perro joven"></td>
                    </tr>
                    <tr>
                        <td>2025-09-01 12:15</td>
                        <td>La Florida</td>
                        <td>Walker Martínez</td>
                        <td>3 perros de 4 meses</td>
                        <td><img src="https://placedog.net/100/74" alt="Foto de cachorros"></td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </main>

    <footer>
        <p>Desarrollo de Aplicaciones Web - Tarea 1</p>
        <p>Gabriel Gallardo R.</p>
    </footer>

</body>
</html>